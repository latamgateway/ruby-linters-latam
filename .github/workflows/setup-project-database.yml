name: Setup project database

on:
  workflow_call:
    inputs:
      repository:
        required: true
      ref:
        required: true
    secrets:
      access-token:
        required: true
        description: |
          Personal access token used to access private repositories.

jobs:
  setup-database:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
        with:
          repository: ${{ inputs.repository }}
          ref: ${{ inputs.ref }}
          token: ${{ secrets.access-token }}

      - uses: ruby/setup-ruby@v1
        env:
          BUNDLE_WITHOUT: "development test"
        with:
          bundler-cache: true

      - name: Setup Database
        env:
          RAILS_ENV: test
        run: bundle exec rake db:create db:migrate
